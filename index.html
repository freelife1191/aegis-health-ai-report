<!DOCTYPE html>
<html lang="ko" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aegis Health AI: 대화형 보고서 (다이어그램 너비 조정)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Brilliant Blues (Applied from Infographic) -->
    <!-- Application Structure Plan: A single-page, scrollable application with a sticky top navigation for easy access to key sections. The structure is designed to tell a story: starting with the vision (Why), moving to the product details (What), then diving deep into the technical architecture (How), and finishing with governance (Responsibility). The centerpiece is an interactive MLOps phase explorer, allowing users to click through the Local, Dev, Stage, and Prod phases to see detailed information, architecture diagrams, and code, making the complex evolution of the system easy to understand. -->
    <!-- Visualization & Content Choices: 
        - Vision: Large, impactful typography. Goal: Inform.
        - User Persona: A styled card. Goal: Inform.
        - MVP Features: An interactive tab/toggle system to switch between Frontend and Backend specifications. This now includes a LIVE Gemini-powered chat demo for the frontend, allowing users to ask a question and receive an evidence-based answer, followed by a personalized action plan. Goal: Demonstrate core functionality. Method: HTML/JS Toggle + Gemini API fetch. Justification: Makes the product vision tangible and interactive.
        - MLOps Phases: An interactive diagram built with HTML/CSS and JS. Users click phase buttons to update the diagram and text content. Diagrams are now rendered with pure HTML/CSS, removing image dependencies. Goal: Compare/Change. Method: JS + HTML. Justification: Enables users to explore the project's phased development interactively and reliably.
        - Cost & Complexity Chart: A Bar Chart. Goal: Compare. Method: Chart.js/Canvas. Justification: Provides a quick quantitative comparison of the development phases. Required tooltip callback and label wrapping logic are implemented.
        - GRC Section: Styled cards with Unicode icons. Goal: Inform. Method: HTML/Tailwind. Justification: Cleanly presents key non-functional requirements.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #D4F1F4; /* Infographic background color */
        }
        .chart-container {
            position: relative;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            height: 40vh;
            max-height: 400px;
        }
        .nav-link {
            transition: all 0.3s;
        }
        .nav-link.active {
            color: #189AB4; /* Active color from infographic */
            transform: scale(1.1);
        }
        .phase-button {
            transition: all 0.2s ease-in-out;
        }
        .phase-button.active {
            background-color: #189AB4;
            color: #D4F1F4;
            transform: translateY(-2px);
        }
        .content-card {
            background-color: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(5px);
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1);
        }
        .chat-bubble {
            max-width: 75%;
            padding: 10px 15px;
            border-radius: 1.25rem;
        }
        .user-bubble {
            background-color: #05445E; /* Dark blue from infographic */
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 0.25rem;
        }
        .ai-bubble {
            background-color: #e2e8f0;
            color: #1e293b;
            align-self: flex-start;
            border-bottom-left-radius: 0.25rem;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #189AB4;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Diagram Styles */
        .flow-arrow {
            font-size: 1.25rem;
            line-height: 1.75rem;
            color: #4A5568;
            font-weight: bold;
        }
        .component {
            border: 1px solid #e2e8f0;
            background-color: #f7fafc;
            border-radius: 0.375rem;
            padding: 0.5rem;
            text-align: center;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            font-weight: 500;
        }
        .sub-system {
            border: 2px dashed #a0aec0;
            background-color: #ffffff;
            border-radius: 0.75rem;
            padding: 1rem;
        }
    </style>
</head>
<body class="bg-[#D4F1F4]">

    <nav id="navbar" class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-md transition-all duration-300">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-2">
                    <span class="text-2xl font-bold text-[#189AB4]">🛡️</span>
                    <span class="text-xl font-bold text-[#05445E]">Aegis Health AI</span>
                </div>
                <div class="hidden md:flex items-center space-x-6">
                    <a href="#vision" class="nav-link text-gray-700 hover:text-[#189AB4] font-medium">비전</a>
                    <a href="#core-tech" class="nav-link text-gray-700 hover:text-[#189AB4] font-medium">핵심 기술</a>
                    <a href="#product" class="nav-link text-gray-700 hover:text-[#189AB4] font-medium">제품 명세</a>
                    <a href="#architecture" class="nav-link text-gray-700 hover:text-[#189AB4] font-medium">아키텍처</a>
                    <a href="#governance" class="nav-link text-gray-700 hover:text-[#189AB4] font-medium">거버넌스</a>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-gray-700 focus:outline-none">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden">
            <a href="#vision" class="block py-2 px-4 text-sm text-gray-600 hover:bg-teal-50">비전</a>
            <a href="#product" class="block py-2 px-4 text-sm text-gray-600 hover:bg-teal-50">제품 명세</a>
            <a href="#architecture" class="block py-2 px-4 text-sm text-gray-600 hover:bg-teal-50">아키텍처</a>
            <a href="#governance" class="block py-2 px-4 text-sm text-gray-600 hover:bg-teal-50">거버넌스</a>
        </div>
    </nav>

    <main class="container mx-auto p-4 md:p-8">
        
        <section id="vision" class="py-16">
            <div class="max-w-5xl mx-auto text-center">
                <h1 class="text-5xl md:text-7xl font-black text-[#05445E]">Aegis Health AI</h1>
                <p class="mt-4 text-xl md:text-2xl font-medium text-[#189AB4]">신뢰할 수 있는 당신의 개인 맞춤형 건강 코파일럿</p>
                
                <div class="mt-10 grid md:grid-cols-2 gap-6 text-left">
                    <div class="content-card p-6">
                        <h2 class="text-2xl font-bold text-[#05445E] mb-3">❓ 문제점</h2>
                        <p class="text-gray-700 leading-relaxed">건강 정보는 넘쳐나지만, 광고와 검증되지 않은 내용으로 가득 차 있습니다. 사용자는 어떤 정보를 믿어야 할지 혼란스럽습니다.</p>
                    </div>
                    <div class="bg-[#05445E] rounded-xl shadow-lg p-6 text-white">
                        <h2 class="text-2xl font-bold text-[#75E6DA] mb-3">💡 우리의 해결책</h2>
                        <p class="text-[#D4F1F4] leading-relaxed">모든 답변의 근거가 되는 <strong class="font-bold">과학 연구 논문</strong>을 명확히 제시합니다. '신뢰'를 핵심 기능으로 제공하여 사용자가 정보에 입각한 건강 결정을 내리도록 돕습니다.</p>
                    </div>
                </div>

                 <div class="mt-8 p-6 bg-white/70 backdrop-blur-sm rounded-xl shadow-lg text-left">
                    <p class="text-gray-700 leading-relaxed">
                        Aegis Health AI는 파편화된 건강 정보 시장에 새로운 기준을 제시합니다. 저희는 과학적 증거에 기반한 답변과 명확한 출처를 제공하여 사용자가 자신의 건강에 대해 정보에 입각한 결정을 내릴 수 있도록 돕습니다. MVP의 핵심은 검증된 학술 연구 결과를 검색하고, 이를 바탕으로 <strong class="font-bold">Gemini AI</strong>가 생성한 답변과 <strong class="font-bold">검증 가능한 출처(verifiable source)</strong>를 함께 제공하여 정보의 신뢰성을 극대화하는 것입니다.
                    </p>
                </div>

                <div class="mt-8 grid md:grid-cols-2 gap-6 text-left">
                    <div class="content-card p-6">
                        <h2 class="text-xl font-bold text-[#05445E] mb-3">👨‍💻 사용자 페르소나: 김현우 (35세)</h2>
                        <p class="text-gray-700 leading-relaxed">건강에 관심이 많지만, 넘쳐나는 광고성, 비검증 정보에 지쳐있습니다. "내가 먹는 크레아틴이 정말 효과가 있는지, 부작용은 없는지 과학적인 근거를 바탕으로 알고 싶다"는 명확한 니즈를 가지고 있습니다.</p>
                    </div>
                    <div class="content-card p-6">
                        <h2 class="text-xl font-bold text-[#05445E] mb-3">🎯 핵심 사용자 스토리</h2>
                        <ul class="text-gray-700 leading-relaxed list-disc list-inside space-y-2">
                           <li>자연어 질문으로 신뢰성 있는 건강 정보를 얻고 싶다.</li>
                           <li>복잡한 논문을 직접 읽지 않고 핵심 결과를 요약 받고 싶다.</li>
                           <li>AI 답변의 근거가 된 실제 연구 출처를 확인하고 싶다.</li>
                           <li>✨ AI 답변을 바탕으로 개인 맞춤형 실천 계획을 얻고 싶다.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="core-tech" class="py-16">
             <h2 class="text-3xl md:text-4xl font-bold text-center text-[#05445E] mb-8">💡 핵심 기술: 증거 기반 Q&A 파이프라인</h2>
             <div class="max-w-5xl mx-auto content-card p-6">
                 <div class="flex flex-col space-y-3 text-center text-sm md:text-base max-w-2xl mx-auto">
                    <div class="bg-gray-100 p-3 rounded-lg shadow-inner">1. 사용자 질문 입력<br><span class="font-mono text-[#189AB4]">"크레아틴은 여성에게 안전한가요?"</span></div>
                    <div class="font-bold text-2xl text-gray-400 self-center">↓</div>
                    <div class="bg-gray-100 p-3 rounded-lg shadow-inner">2. Consensus API 호출<br><span class="font-mono text-gray-600">질문과 관련된 학술 논문 검색</span></div>
                     <div class="font-bold text-2xl text-gray-400 self-center">↓</div>
                    <div class="bg-gray-100 p-3 rounded-lg shadow-inner">3. 검색 증강 생성 (RAG)<br><span class="font-mono text-gray-600">검색된 논문(Context) + 질문(Question)으로 LLM 프롬프트 구성</span></div>
                    <div class="font-bold text-2xl text-gray-400 self-center">↓</div>
                    <div class="bg-[#75E6DA] p-3 rounded-lg shadow font-bold text-[#05445E]">4. 답변 및 출처 제공<br><span class="font-normal font-mono text-gray-700">"네, 안전합니다..." + 근거 논문 목록</span></div>
                 </div>
            </div>
        </section>


        <section id="product" class="py-16">
            <h2 class="text-3xl md:text-4xl font-bold text-center text-[#05445E] mb-8">MVP 제품 명세 (Live Demo)</h2>
            <div class="max-w-5xl mx-auto p-6 content-card">
                <div class="flex justify-center mb-6">
                    <div class="flex space-x-1 bg-gray-200 p-1 rounded-full">
                        <button id="btn-frontend" class="px-4 py-2 text-sm font-medium rounded-full bg-white text-[#189AB4] shadow">라이브 데모</button>
                        <button id="btn-backend" class="px-4 py-2 text-sm font-medium rounded-full text-gray-600">백엔드 명세</button>
                    </div>
                </div>

                <div id="content-frontend">
                    <h3 class="text-2xl font-bold mb-4 text-[#05445E]">메인 Q&A 대시보드 (Gemini AI 연동)</h3>
                    <div class="bg-gray-100 rounded-lg p-4">
                        <div id="chat-window" class="h-80 overflow-y-auto mb-4 p-2 flex flex-col space-y-4">
                            <div class="chat-bubble ai-bubble">
                                <p>안녕하세요! Aegis Health AI입니다. 건강에 대해 궁금한 점을 무엇이든 물어보세요. 예: "크레아틴의 효능과 부작용은 무엇인가요?"</p>
                            </div>
                        </div>
                        <div id="loader-container" class="flex justify-center items-center h-12 hidden">
                            <div class="loader"></div>
                        </div>
                        <form id="chat-form" class="flex items-center space-x-2">
                            <input type="text" id="chat-input" class="flex-grow p-3 border rounded-full focus:ring-2 focus:ring-[#189AB4] focus:outline-none" placeholder="여기에 질문을 입력하세요...">
                            <button type="submit" class="bg-[#189AB4] hover:bg-[#05445E] text-white font-bold p-3 rounded-full transition duration-300 flex items-center justify-center">
                                <span class="text-xl">✨</span>
                            </button>
                        </form>
                         <div id="action-plan-container" class="mt-4"></div>
                    </div>
                </div>

                <div id="content-backend" class="hidden">
                     <h3 class="text-2xl font-bold mb-4 text-[#05445E]">백엔드 (FastAPI)</h3>
                     <p class="text-gray-600 mb-6">프론트엔드의 요청 처리, 외부 API 연동, RAG 파이프라인 오케스트레이션을 담당합니다.</p>
                     <div class="space-y-6">
                        <div>
                            <h4 class="text-xl font-semibold mb-2 text-gray-800">API 엔드포인트</h4>
                            <div class="bg-gray-100 p-4 rounded-lg font-mono text-sm overflow-x-auto">
                                <p><strong class="font-bold text-[#189AB4]">POST</strong> /api/v1/query &nbsp;&nbsp;&nbsp; (RAG 파이프라인 실행)</p>
                                <p><strong class="font-bold text-[#189AB4]">POST</strong> /api/v1/action-plan &nbsp;&nbsp;&nbsp; (✨ 개인 맞춤형 실천 계획 생성)</p>
                            </div>
                        </div>
                        <div>
                             <h4 class="text-xl font-semibold mb-2 text-gray-800">RAG 파이프라인 알고리즘</h4>
                             <ol class="list-decimal list-inside text-gray-600 space-y-1">
                                 <li>사용자 질문(`query_text`) 수신</li>
                                 <li>`Consensus.app` API로 관련 논문 검색 (Retrieve)</li>
                                 <li>검색된 논문 초록과 질문으로 프롬프트 구성 (Augment)</li>
                                 <li>구성된 프롬프트를 <strong class="font-bold">Gemini API</strong>로 전송 (Generate)</li>
                                 <li>LLM 답변과 논문 출처를 조합하여 최종 응답 생성</li>
                             </ol>
                        </div>
                     </div>
                </div>
            </div>
        </section>


        <section id="architecture" class="py-16">
            <h2 class="text-3xl md:text-4xl font-bold text-center text-[#05445E] mb-2">MLOps 진화 청사진</h2>
            <p class="text-center text-gray-600 mb-8">Aegis Health AI는 4단계에 걸쳐 점진적으로 진화하며 시스템을 성숙시킵니다.</p>

            <div class="flex flex-wrap justify-center gap-2 md:gap-4 mb-8">
                <button data-phase="1" class="phase-button active px-4 py-2 rounded-full font-semibold shadow-md">Phase 1: Local</button>
                <button data-phase="2" class="phase-button px-4 py-2 rounded-full font-semibold shadow-md bg-white">Phase 2: Dev</button>
                <button data-phase="3" class="phase-button px-4 py-2 rounded-full font-semibold shadow-md bg-white">Phase 3: Stage</button>
                <button data-phase="4" class="phase-button px-4 py-2 rounded-full font-semibold shadow-md bg-white">Phase 4: Prod</button>
            </div>

            <div class="mt-12 max-w-5xl mx-auto content-card p-6">
                <div id="phase-details" class="content-card p-6 md:p-8 min-h-[450px] transition-all duration-500">
                </div>
            </div>

            <div class="mt-12 max-w-5xl mx-auto content-card p-6">
                <h3 class="text-2xl font-bold text-center text-[#05445E] mb-6">단계별 비용 및 복잡도</h3>
                <div class="chart-container bg-white/50 p-4 rounded-lg max-w-2xl">
                    <canvas id="complexityChart"></canvas>
                </div>
            </div>
        </section>

        <section id="governance" class="py-16">
             <h2 class="text-3xl font-bold text-center text-[#05445E] mb-8">🏛️ 거버넌스, 위험 및 규정 준수 (GRC)</h2>
             <p class="max-w-3xl mx-auto text-center text-gray-600 mb-10">실제 헬스케어 애플리케이션은 기술적 우수성을 넘어 윤리적, 규제적 책임을 다해야 합니다. Aegis Health AI는 설계 단계부터 신뢰성, 공정성, 보안을 핵심 비기능적 요구사항으로 고려합니다.</p>
            <div class="grid md:grid-cols-3 gap-6">
                <div class="content-card p-6 text-center">
                    <div class="text-4xl mb-3">✅</div>
                    <h3 class="text-xl font-bold text-gray-800">신뢰성 (Reliability)</h3>
                    <p class="text-sm text-gray-600 mt-2">모든 답변은 RAG를 통해 실제 연구 결과에 기반하여 'AI 환각(Hallucination)' 현상을 최소화합니다. 신뢰도 점수가 낮은 답변은 안전한 대체 응답을 반환합니다.</p>
                </div>
                 <div class="content-card p-6 text-center">
                    <div class="text-4xl mb-3">⚖️</div>
                    <h3 class="text-xl font-bold text-gray-800">공정성 (Fairness)</h3>
                    <p class="text-sm text-gray-600 mt-2">다양한 인구 집단에 대한 답변의 일관성을 벤치마크 테스트하여 잠재적 편향을 완화하고, 데이터 소스의 대표성을 지속적으로 감사합니다.</p>
                </div>
                 <div class="content-card p-6 text-center">
                    <div class="text-4xl mb-3">🛡️</div>
                    <h3 class="text-xl font-bold text-gray-800">보안 (Security)</h3>
                    <p class="text-sm text-gray-600 mt-2">민감한 건강 정보 보호를 위해 설계 단계부터 HIPAA 규정 준수를 고려한 아키텍처(데이터 암호화, 접근 제어, 감사 로깅)를 적용합니다.</p>
                </div>
            </div>
        </section>

    </main>

    <footer class="text-center py-8">
        <p class="text-sm text-[#189AB4]">Aegis Health AI Interactive Report | June 2025</p>
    </footer>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- Gemini API Integration ---
            const chatWindow = document.getElementById('chat-window');
            const chatForm = document.getElementById('chat-form');
            const chatInput = document.getElementById('chat-input');
            const loader = document.getElementById('loader-container');
            const actionPlanContainer = document.getElementById('action-plan-container');
            let lastAiResponse = "";

            async function callGemini(prompt) {
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const payload = {
                    contents: [{
                        role: "user",
                        parts: [{ text: prompt }]
                    }]
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API call failed with status: ${response.status}`);
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0) {
                        return result.candidates[0].content.parts[0].text;
                    }
                    return "죄송합니다. 답변을 생성하는 데 실패했습니다.";
                } catch (error) {
                    console.error("Gemini API Error:", error);
                    return "죄송합니다. AI 서비스에 오류가 발생했습니다. 잠시 후 다시 시도해 주세요.";
                }
            }

            if (chatForm) {
                chatForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const userInput = chatInput.value.trim();
                    if (!userInput) return;
                    
                    appendMessage(userInput, 'user');
                    chatInput.value = '';
                    loader.classList.remove('hidden');
                    actionPlanContainer.innerHTML = '';

                    const mockContext = `
                        연구 1 (Buford et al., 2007, Journal of the International Society of Sports Nutrition): 크레아틴 모노하이드레이트는 단기간 고강도 운동 능력 향상에 가장 효과적인 보충제 중 하나이다. 하루 3-5g 섭취는 안전하며, 근육량과 근력 증가에 기여할 수 있다. 일부 사용자는 경미한 위장 장애를 경험할 수 있다.
                        연구 2 (Kreider et al., 2017, Journal of the International Society of Sports Nutrition): 장기간 크레아틴 섭취가 신장 기능에 해롭다는 증거는 없다. 운동선수에게 크레아틴 보충은 근육 성능 회복을 돕고 부상 위험을 줄일 수 있다.
                    `;

                    const ragPrompt = `
                        당신은 의학 및 영양학 전문가입니다. 아래의 과학적 연구 컨텍스트를 바탕으로 사용자의 질문에 대해 명확하고 이해하기 쉽게 답변해주세요. 답변은 반드시 컨텍스트에 근거해야 하며, 마지막에 출처를 명시해주세요.

                        # 컨텍스트:
                        ${mockContext}

                        # 사용자 질문:
                        ${userInput}

                        # 답변 형식:
                        [답변 내용]

                        ---
                        **출처:**
                        * Buford, T. W., et al. (2007).
                        * Kreider, R. B., et al. (2017).
                    `;

                    const aiResponse = await callGemini(ragPrompt);
                    loader.classList.add('hidden');
                    appendMessage(aiResponse, 'ai');
                    lastAiResponse = aiResponse;
                    showActionPlanButton();
                });
            }

            function appendMessage(message, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `chat-bubble ${sender === 'user' ? 'user-bubble' : 'ai-bubble'}`;
                let formattedMessage = message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                formattedMessage = formattedMessage.replace(/(\n\s*\*)/g, '<br>• ');
                messageDiv.innerHTML = `<p>${formattedMessage}</p>`;
                if(chatWindow) chatWindow.appendChild(messageDiv);
                if(chatWindow) chatWindow.scrollTop = chatWindow.scrollHeight;
            }

            function showActionPlanButton() {
                const button = document.createElement('button');
                button.id = 'action-plan-btn';
                button.className = 'w-full mt-4 bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-4 rounded-full transition duration-300';
                button.innerHTML = '✨ 나만의 실천 계획 만들기';
                if(actionPlanContainer) actionPlanContainer.appendChild(button);

                button.addEventListener('click', async () => {
                    if(loader) loader.classList.remove('hidden');
                    button.disabled = true;
                    button.textContent = '생성 중...';

                    const actionPlanPrompt = `
                        당신은 전문 헬스 트레이너이자 영양사입니다. 아래 대화 내용을 바탕으로 '김현우(35세, 남성, 건강과 근력 운동에 관심 많음)'님을 위한 주간 실천 계획을 구체적으로 작성해주세요. 계획은 요일별로 나누고, 실천하기 쉬운 형태로 제안해주세요.

                        # 이전 대화 내용:
                        ${lastAiResponse}

                        # 실천 계획 형식:
                        **김현우님을 위한 주간 건강 실천 계획**
                        * **월요일:** [구체적인 활동 제안]
                        * **수요일:** [구체적인 활동 제안]
                        * **금요일:** [구체적인 활동 제안]
                        * **주말 팁:** [주말에 참고할 만한 추가 팁]
                    `;
                    
                    const planResponse = await callGemini(actionPlanPrompt);
                    if(loader) loader.classList.add('hidden');
                    if(actionPlanContainer) actionPlanContainer.innerHTML = '';
                    const planCard = document.createElement('div');
                    planCard.className = 'p-4 bg-[#75E6DA]/20 border border-[#189AB4]/30 rounded-lg mt-4';
                    
                    let formattedPlan = planResponse.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    formattedPlan = formattedPlan.replace(/(\n\s*\*)/g, '<br>• ');
                    planCard.innerHTML = formattedPlan;

                    if(actionPlanContainer) actionPlanContainer.appendChild(planCard);
                });
            }


            // --- MLOps Phase Switcher Logic ---
            const phaseData = {
                '1': {
                    title: 'Phase 1: Local - 로컬 개발 환경',
                    goal: '최소 비용으로 단일 머신에서 전체 서비스의 핵심 기능을 개발하고 디버깅합니다.',
                    diagramHtml: `
                        <div class="flex flex-col items-center space-y-2 text-sm">
                            <div class="component w-32">👨‍💻 사용자</div>
                            <div class="flow-arrow">↓</div>
                            <div class="sub-system w-full p-3">
                                <h3 class="font-semibold text-center mb-2 text-gray-600 text-xs">Developer's Local Machine (Docker Compose)</h3>
                                <div class="flex justify-around items-center bg-white p-2 rounded-lg border">
                                    <div class="component">Frontend<br>(Gradio)</div>
                                    <div class="flow-arrow">↔</div>
                                    <div class="component">Backend<br>(FastAPI)</div>
                                    <div class="flow-arrow">↔</div>
                                    <div class="flex flex-col space-y-1">
                                        <div class="component text-xs">PostgreSQL</div>
                                        <div class="component text-xs">ChromaDB</div>
                                    </div>
                                </div>
                                 <div class="flex justify-around items-start mt-2">
                                    <div class="flex flex-col items-center">
                                        <div class="flow-arrow text-xs">↓</div>
                                        <div class="component text-xs mt-1">Consensus API</div>
                                    </div>
                                    <div class="flex flex-col items-center">
                                        <div class="flow-arrow text-xs">↓</div>
                                        <div class="component text-xs mt-1">External LLM API</div>
                                    </div>
                                </div>
                            </div>
                        </div>`,
                    stack: ['Docker Compose', 'FastAPI', 'Gradio', 'External LLM API'],
                    code: `
# docker-compose.yml
version: '3.8'
services:
  backend:
    build:./backend
    ports: ["8000:8000"]
    environment:
      - LLM_API_KEY=\${LLM_API_KEY}
  frontend:
    build:./frontend
    ports: ["7860:7860"]
    depends_on: [backend]
`
                },
                '2': {
                    title: 'Phase 2: Dev - 클라우드 개발 환경',
                    goal: '최소 비용의 클라우드 환경에서 시스템을 통합하고 테스트합니다. 비용 최적화가 최우선 순위입니다.',
                    diagramHtml: `
                        <div class="flex flex-col items-center space-y-2 text-sm">
                            <div class="component w-32">👨‍💻 사용자</div>
                             <div class="flow-arrow">↓</div>
                            <div class="sub-system w-full p-3">
                                <h3 class="font-semibold text-center mb-2 text-gray-600 text-xs">AWS Cloud</h3>
                                <div class="component mb-2 text-xs">Application Load Balancer</div>
                                <div class="flow-arrow text-center text-xs">↓</div>
                                <div class="sub-system w-full p-2 bg-blue-50 border-blue-200">
                                     <h4 class="font-semibold text-center text-xs mb-2 text-blue-700">Amazon EKS Cluster</h4>
                                     <div class="grid grid-cols-2 gap-2 text-xs">
                                        <div class="component">Frontend</div>
                                        <div class="component">Backend</div>
                                        <div class="component col-span-2">Triton + vLLM<br>(on GPU Spot Node)</div>
                                     </div>
                                </div>
                                <div class="flow-arrow text-center text-xs">↓</div>
                                <div class="flex justify-around w-full mt-2 text-xs">
                                     <div class="component">AWS RDS<br>(PostgreSQL)</div>
                                     <div class="component">ChromaDB<br>(on EBS)</div>
                                </div>
                            </div>
                        </div>`,
                    stack: ['AWS EKS', 'Spot Instance', 'Terraform', 'Triton (vLLM)'],
                    code: `
# eks_nodes.tf (Terraform)
eks_managed_node_groups = {
  gpu_spot = {
    instance_types = ["g4dn.xlarge"]
    capacity_type  = "SPOT"
    min_size       = 0
    max_size       = 1
  }
}
`
                },
                '3': {
                    title: 'Phase 3: Stage - 스테이징 환경',
                    goal: '프로덕션 환경과 유사한 구성에서 최종 릴리스를 테스트하고 GitOps 기반의 CI/CD를 자동화합니다.',
                    diagramHtml: `
                        <div class="flex flex-col md:flex-row justify-between items-center space-y-2 md:space-y-0 md:space-x-2 text-sm">
                            <div class="sub-system w-full md:w-1/2 p-2 text-center">
                                <h3 class="font-semibold mb-2 text-gray-600 text-xs">Development & CI</h3>
                                <div class="component text-xs">Developer</div>
                                <div class="flow-arrow text-xs">↓ Git Push</div>
                                <div class="component text-xs">GitHub</div>
                                <div class="flow-arrow text-xs">↓ Trigger</div>
                                <div class="component text-xs">GitHub Actions</div>
                                <div class="flex justify-around mt-1">
                                    <div>
                                        <div class="flow-arrow text-xs">↓ Push</div>
                                        <div class="component text-xs">Amazon ECR</div>
                                    </div>
                                     <div>
                                        <div class="flow-arrow text-xs">↓ Update</div>
                                        <div class="component text-xs">K8s Manifests</div>
                                    </div>
                                </div>
                            </div>
                            <div class="flow-arrow hidden md:block">→</div>
                             <div class="flow-arrow md:hidden">↓</div>
                            <div class="sub-system w-full md:w-1/2 p-2 text-center">
                                <h3 class="font-semibold mb-2 text-gray-600 text-xs">Staging on AWS (GitOps)</h3>
                                <div class="component text-xs">K8s Manifests</div>
                                <div class="flow-arrow text-xs">↓ Pull</div>
                                <div class="component text-xs">ArgoCD</div>
                                <div class="flow-arrow text-xs">↓ Sync</div>
                                 <div class="sub-system p-2 bg-green-50 border-green-200">
                                     <h4 class="font-semibold text-center text-xs text-green-700">EKS Cluster</h4>
                                      <div class="component text-xs">App Services</div>
                                </div>
                            </div>
                        </div>`,
                    stack: ['AWS EKS', 'GitOps (ArgoCD)', 'GitHub Actions', 'Helm'],
                    code: `
# argocd-app.yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: aegis-stage
spec:
  source:
    repoURL: 'https://github.com/your/k8s-manifests.git'
    path: helm-charts/aegis-app
  destination:
    namespace: aegis-stage
  syncPolicy:
    automated: { selfHeal: true }
`
                },
                '4': {
                    title: 'Phase 4: Prod - 프로덕션 환경',
                    goal: '고가용성, 확장성, 보안을 갖춘 실제 서비스 운영 환경을 구축하고 실시간으로 모니터링합니다.',
                    diagramHtml: `
                         <div class="sub-system w-full p-2 text-sm">
                            <h3 class="font-semibold text-center mb-1 text-xs text-gray-600">AWS Cloud (Production)</h3>
                            <div class="component w-32 mx-auto text-xs">👨‍💻 사용자</div>
                            <div class="flow-arrow text-center text-xs">↓</div>
                            <div class="component w-full text-xs">Edge & Security (CloudFront → WAF)</div>
                            <div class="flow-arrow text-center text-xs">↓</div>
                            <div class="component w-full text-xs">Application Load Balancer</div>
                            <div class="flow-arrow text-center text-xs">↓</div>
                             <div class="grid grid-cols-3 gap-2 mt-1">
                                <div class="sub-system p-2 bg-purple-50 border-purple-200 col-span-2">
                                    <h4 class="font-semibold text-center text-xs mb-1 text-purple-700">Amazon EKS Cluster</h4>
                                    <div class="component mb-1 text-xs">App Services</div>
                                    <div class="grid grid-cols-2 gap-1 text-xs">
                                        <div class="component">Karpenter</div>
                                        <div class="component">Argo Workflows</div>
                                        <div class="component col-span-2">Observability</div>
                                    </div>
                                </div>
                                <div class="sub-system p-2 bg-yellow-50 border-yellow-200">
                                     <h4 class="font-semibold text-center text-xs mb-1 text-yellow-700">Managed Data</h4>
                                     <div class="space-y-1 text-xs">
                                        <div class="component">RDS</div>
                                        <div class="component">S3</div>
                                        <div class="component">ElastiCache</div>
                                        <div class="component">Vector DB</div>
                                     </div>
                                </div>
                             </div>
                         </div>`,
                    stack: ['Karpenter', 'Prometheus', 'Grafana', 'HIPAA Compliance'],
                    code: `
# karpenter-provisioner.yaml
apiVersion: karpenter.sh/v1beta1
kind: NodePool
metadata:
  name: default
spec:
  template:
    spec:
      requirements:
        - key: "karpenter.sh/capacity-type"
          operator: In
          values: ["on-demand", "spot"]
`
                }
            };

            const phaseDetailsContainer = document.getElementById('phase-details');
            const phaseButtons = document.querySelectorAll('.phase-button');

            function updatePhaseContent(phase) {
                const data = phaseData[phase];
                if (!data) return;
                
                const codeSnippetHtml = data.code ? `
                    <div>
                        <h4 class="text-lg font-semibold mb-3 text-gray-800">핵심 코드 예시</h4>
                        <pre class="bg-gray-800 text-white p-4 rounded-lg text-xs overflow-x-auto"><code>${data.code.trim().replace(/</g, "&lt;").replace(/>/g, "&gt;")}</code></pre>
                    </div>` : '';

                if (phaseDetailsContainer) {
                    phaseDetailsContainer.innerHTML = `
                        <h3 class="text-2xl font-bold text-[#05445E] mb-2">${data.title}</h3>
                        <p class="text-gray-600 mb-6">${data.goal}</p>
                        <div class="grid grid-cols-1 gap-6">
                            <div>
                                 <h4 class="text-lg font-semibold mb-3 text-gray-800">아키텍처 다이어그램</h4>
                                 <div class="p-2 border rounded-lg bg-white">
                                    ${data.diagramHtml}
                                 </div>
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <h4 class="text-lg font-semibold mb-3 text-gray-800">주요 기술 스택</h4>
                                    <div class="flex flex-wrap gap-2">
                                        ${data.stack.map(tech => `<span class="bg-[#189AB4] text-white text-sm font-medium px-2.5 py-0.5 rounded-full">${tech}</span>`).join('')}
                                    </div>
                                </div>
                                ${codeSnippetHtml}
                            </div>
                        </div>
                    `;
                }
            }

            phaseButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const phase = e.currentTarget.dataset.phase;
                    updatePhaseContent(phase);

                    phaseButtons.forEach(btn => {
                        btn.classList.remove('active');
                        btn.classList.add('bg-white', 'text-gray-700');
                    });
                    e.currentTarget.classList.add('active');
                    e.currentTarget.classList.remove('bg-white', 'text-gray-700');
                });
            });
            
            updatePhaseContent('1');
            
            const ctx = document.getElementById('complexityChart').getContext('2d');
            if (ctx) {
                const chartLabels = ['Phase 1: Local', 'Phase 2: Dev', 'Phase 3: Stage', 'Phase 4: Prod'];
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: chartLabels.map(label => {
                            if (label.length > 16) {
                                const words = label.split(' ');
                                let lines = [];
                                let currentLine = '';
                                words.forEach(word => {
                                    if ((currentLine + word).length > 16) {
                                        lines.push(currentLine.trim());
                                        currentLine = '';
                                    }
                                    currentLine += word + ' ';
                                });
                                lines.push(currentLine.trim());
                                return lines;
                            }
                            return label;
                        }),
                        datasets: [{
                            label: '비용',
                            data: [1, 3, 5, 8],
                            backgroundColor: 'rgba(24, 154, 180, 0.7)',
                            borderColor: 'rgba(24, 154, 180, 1)',
                            borderWidth: 1
                        }, {
                            label: '복잡도',
                            data: [2, 4, 7, 9],
                            backgroundColor: 'rgba(5, 68, 94, 0.7)',
                            borderColor: 'rgba(5, 68, 94, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 10,
                                ticks: {
                                    stepSize: 2
                                }
                            }
                        },
                        plugins: {
                            legend: {
                               position: 'top',
                            },
                            tooltip: {
                                callbacks: {
                                    title: function(tooltipItems) {
                                        const item = tooltipItems[0];
                                        let label = item.chart.data.labels[item.dataIndex];
                                        if (Array.isArray(label)) {
                                          return label.join(' ');
                                        } else {
                                          return label;
                                        }
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Mobile Menu Toggle
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenuButton) {
                mobileMenuButton.addEventListener('click', () => {
                    if (mobileMenu) mobileMenu.classList.toggle('hidden');
                });
            }
            
            // Product Spec Tabs
            const btnFrontend = document.getElementById('btn-frontend');
            const btnBackend = document.getElementById('btn-backend');
            const contentFrontend = document.getElementById('content-frontend');
            const contentBackend = document.getElementById('content-backend');
            
            function setTabActive(activeBtn, inactiveBtn, activeContent, inactiveContent) {
                if (activeContent) activeContent.classList.remove('hidden');
                if (inactiveContent) inactiveContent.classList.add('hidden');
                
                if (activeBtn) {
                    activeBtn.classList.add('bg-white', 'text-[#189AB4]', 'shadow');
                    activeBtn.classList.remove('text-gray-600');
                }

                if (inactiveBtn) {
                    inactiveBtn.classList.remove('bg-white', 'text-[#189AB4]', 'shadow');
                    inactiveBtn.classList.add('text-gray-600');
                }
            }

            if (btnFrontend && btnBackend) {
                btnFrontend.addEventListener('click', () => {
                    setTabActive(btnFrontend, btnBackend, contentFrontend, contentBackend);
                });

                btnBackend.addEventListener('click', () => {
                    setTabActive(btnBackend, btnFrontend, contentBackend, contentFrontend);
                });
            }
        });
    </script>
</body>
</html>
